<!DOCTYPE html><html lang="zh-tw"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 使用 prettier 自動調整 JavaScript 樣式 · 蝌蚪伯的摳頂筆記</title><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="description" content="使用 prettier 自動調整 JavaScript 樣式 - Jason C. Huang"><meta name="keywords"><meta name="author" content="Jason C. Huang"><link rel="short icon" href="/blog/images/favicon.ico"><link rel="stylesheet" href="/blog/css/bubuzou.css"><link rel="search" type="application/opensearchdescription+xml" href="http://kaddopur.github.io/blog/atom.xml" title="蝌蚪伯的摳頂筆記"></head><body><header><div class="header row"> <a href="/blog/" class="logo-link">蝌蚪伯的摳頂筆記</a><ul class="nav nav-list"><li class="nav-list-item"><a href="/blog/archives/" target="_self" data-hover="歸檔" class="nav-list-link">歸檔</a></li><li class="nav-list-item"><a href="/blog/categories/週記/" target="_self" data-hover="週記" class="nav-list-link">週記</a></li><li class="nav-list-item"><a href="/blog/categories/隨筆/" target="_self" data-hover="隨筆" class="nav-list-link">隨筆</a></li><li class="nav-list-item"><a href="/blog/tags/Elixir/" target="_self" data-hover="ELIXIR" class="nav-list-link">ELIXIR</a></li><li class="nav-list-item"><a href="https://kaddopur.github.io/" target="_blank" data-hover="關於" class="nav-list-link">關於</a></li></ul><div class="search"><a id="search_btn" href="#search"></a></div></div></header><div class="row scroll-con"><section class="container"><!-- for archive page--><div id="postAr" class="post"><article class="post-block"><h1 class="post-title">使用 prettier 自動調整 JavaScript 樣式</h1><div class="post-info">2017-05-10 17:41</div><div class="post-content"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><code>prettier</code> 是一款 JavaScript 的樣式處理工具，它類似 golang 的 <code>gofmt</code> 可以自動排版你的程式。除了 Vanilla JS 之外，尚支援了 ES6, jsx, Flow 以及正在開發中的 TypeScript。它是由 <a href="https://twitter.com/vjeux" target="_blank" rel="external">vjeux (Christopher Chedeau)</a>  開發，在 <a href="https://github.com/prettier/prettier" target="_blank" rel="external">github</a> 上面約有 10,000 個 stars。</p>
<p><code>prettier</code> 從今年一月的第一個 commit 開始到現在快半年，不過到它真正引起我的興趣，是從上週 (5/3) 釋出的 <code>v1.3.0</code> 開始。至於這個版本有什麼特別的功能嗎？非也。主要是因為這個版本有公開它在 Facebook 內部各專案使用 <code>prettier</code> 的情形。</p>
<a id="more"></a>
<blockquote>
<p>The first projects to adopt prettier were Jest, React and immutable-js. Those are small codebases in the order of hundreds of files that have their own infrastructure. There are a handful of people working on them full time.<br><br>Then, Oculus and Nuclide converted their codebase over. The scale is bigger with a few thousands of files and tens of full time contributors but looks pretty similar to the first projects. The conversions went in one big codemod and that’s it.</p>
</blockquote>
<p>可以看到 Facebook 的專案一個接一個開始用 <code>prettier</code> 來規範及管理他們的 JavaScript 樣式，而 <code>prettier</code> 和我們平常在用的 <code>eslint</code> 或是其他的 lint 工具相比之下孰優孰劣呢？</p>
<h2 id="優點"><a href="#優點" class="headerlink" title="優點"></a>優點</h2><ol>
<li><p><strong>一致性 Consistency</strong><br>同一種表達式對於不同的人可能會有不同的寫法，使用 <code>prettier</code> 可以輕易保持代碼中樣式的一致式，避免個人習慣樣式的不同。</p>
</li>
<li><p><strong>可教性 Teachability</strong><br>經過 <code>prettier</code> 調整格式之後，你可以知道 JavaScript 引擎是怎麼解析你所寫的代碼，進而幫助你養成良好的撰寫習慣來避免一些語意上的錯誤。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> x = value1 &amp;&amp; value2 || value3 &amp;&amp; value4;</div></pre></td></tr></table></figure>
<p>會幫你加上括號</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> x = (value1 &amp;&amp; value2) || (value3 &amp;&amp; value4);</div></pre></td></tr></table></figure>
</li>
<li><p><strong>自由度 Freedom</strong><br>只需要專心在寫代碼這件事就好了，不用刻意去手動調整樣式。在抽函數的時候也蠻有用的。</p>
</li>
</ol>
<h2 id="如何使用"><a href="#如何使用" class="headerlink" title="如何使用"></a>如何使用</h2><p><code>prettier</code> 提供了 CLI 方便你轉換檔案。你也可以將 <code>prettier</code> 設定在專案的工作流程中，在 commit 時自動排版並簽入至你的 repo。或是你也可以將 <code>prettier</code> 與你最愛的編輯器綁定，讓你在存檔時可以自動排版並看到結果。以下會分別介紹。</p>
<p>可以局部安裝到你的專案<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ yarn add prettier --dev</div></pre></td></tr></table></figure></p>
<p>或是全局安裝<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ yarn global add prettier</div></pre></td></tr></table></figure></p>
<h3 id="CLI"><a href="#CLI" class="headerlink" title="CLI"></a>CLI</h3><p>使用方式如下，可以選擇想要轉換的檔案。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ prettier [opts] [filename ...]</div></pre></td></tr></table></figure></p>
<p>實際上使用的情形可能會像這樣<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ prettier --single-quote --write &quot;&#123;app,__&#123;tests,mocks&#125;__&#125;/**/*.js&quot;</div></pre></td></tr></table></figure></p>
<p>想要知道有什麼參數可以下，可以輸入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$ prettier</div><div class="line">Usage: prettier [opts] [filename ...]</div><div class="line"></div><div class="line">Available options:</div><div class="line">  --write                  Edit the file in-place. (Beware!)</div><div class="line">  --list-different or -l   Print filenames of files that are different from Prettier formatting.</div><div class="line">  --stdin                  Read input from stdin.</div><div class="line">  --print-width &lt;int&gt;      Specify the length of line th</div><div class="line">  ...</div></pre></td></tr></table></figure></p>
<p>會列出所有可以用的選項</p>
<h3 id="Node"><a href="#Node" class="headerlink" title="Node"></a>Node</h3><p>將 <code>husky</code> 和 <code>lint-staged</code> 加到專案的 devDependencies<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ yarn add lint-staged husky --dev</div></pre></td></tr></table></figure></p>
<p>在 <code>package.json</code> 中填加以下 config<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"scripts"</span>: &#123;</div><div class="line">    <span class="attr">"precommit"</span>: <span class="string">"lint-staged"</span></div><div class="line">  &#125;,</div><div class="line">  <span class="attr">"lint-staged"</span>: &#123;</div><div class="line">    <span class="attr">"*.js"</span>: [</div><div class="line">      <span class="string">"prettier --write"</span>,</div><div class="line">      <span class="string">"git add"</span></div><div class="line">    ]</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>husky</code> 會讓專案在 git commit 時執行 “precommit” 這個命令。而在 <code>lint-staged</code> 中，會檢查所有被 stage 的檔案，如果有符合特定檔名，就會再運行指定的命令。</p>
<p>在上面的例子中，我們會在 git commit 之前，對所有被 stage 的 JavaScript 檔案運行 <code>prettier</code> 後，再重新 stage 更新後的檔案，以確保所有進入 repo 的代碼的樣式正確。</p>
<h3 id="Editor"><a href="#Editor" class="headerlink" title="Editor"></a>Editor</h3><p><code>prettier</code> 對大部分的編輯器都有對應的工具，這邊以我的編輯器 VS Code 為例。</p>
<p>去 MartketPlace 下載 [Prettier - JavaScript formatter]<a href="https://marketplace.visualstudio.com/items?itemName=esbenp.prettier-vscode" target="_blank" rel="external">vscode_ext</a>。安裝完成後，可以用 <code>CMD + Shift + P</code> 來重新排版整個檔案，或是用 <code>CMD + Shift + P</code> 重排所選擇的區域。</p>
<p>想要調整 <code>prettier</code> 所使用的排版選項，可以在 <code>User Settings</code> 來全局更改所想要的 <code>prettier</code> 參數，或是也可以用 <code>Workspace Settings</code> 來按照不同專案設定不同選項。</p>
<h2 id="結論"><a href="#結論" class="headerlink" title="結論"></a>結論</h2><p>在專案中，可以無痛導入工作流程而不用特別針對樣式錯誤去手動調整是 <code>prettier</code> 的一大優勢，可以讓 coding style 一次到位，也沒有撰寫代碼時多餘的打字或心理成本。</p>
<p>對於已經導入 <code>eslint</code> 並有團隊自訂 rule set 的專案，<code>prettier</code> 雖可以用參數調整所產出的代碼，但可以調整的地方有限，所產出的代碼也不一定會完全相符於之前的 rule set，這時必定要與團隊成員有良好溝通再行導入，畢竟<strong>“團隊的樣式就是最好的樣式”</strong>。</p>
</div></article></div><div class="right-container"><div class="widget"><div class="category"><h4>分類歸檔</h4><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/blog/categories/新知/">新知</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/週記/">週記</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/blog/categories/隨筆/">隨筆</a><span class="category-list-count">1</span></li></ul></div></div><div class="widget"><div class="tagcloud"><h4>標籤雲</h4><a href="/blog/tags/Elixir/" style="font-size: 10px;">Elixir</a> <a href="/blog/tags/Facebook/" style="font-size: 10px;">Facebook</a> <a href="/blog/tags/JavaScript/" style="font-size: 20px;">JavaScript</a> <a href="/blog/tags/prettier/" style="font-size: 20px;">prettier</a> <a href="/blog/tags/tool/" style="font-size: 10px;">tool</a></div></div><div class="widget"><div class="recent"><h4>最近文章</h4><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/blog/2017/05/10/prettier/">使用 prettier 自動調整 JavaScript 樣式</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/05/06/Y2017W18/">Y2017W18</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/04/29/Y2017W17/">Y2017W17</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2017/04/22/Y2017W16/">Y2017W16</a></li><li class="post-list-item"><a class="post-list-link" href="/blog/2016/05/09/new-post-after-4-years/">四年多來的第一篇</a></li></ul></div></div><div class="widget"><div id="arAnchorBar"></div></div></div></section></div><div class="right-menu"></div><div class="modal search-modal"><div class="input-field"><input type="text" id="search_input"><label for="search-input">搜索</label></div><div id="search_result" class="search-result"></div></div><div class="blog-overlay"></div><footer class="row"><div class="footer-con"><div class="paginator"><a href="/blog/2017/05/06/Y2017W18/" class="prev">上一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'kaddopur';
var disqus_identifier = '2017/05/10/prettier/';
var disqus_title = '使用 prettier 自動調整 JavaScript 樣式';
var disqus_url = 'http://kaddopur.github.io/blog/2017/05/10/prettier/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//kaddopur.disqus.com/count.js" async></script><div class="copyright"><p>© 2016 - 2017 <a target="_blank">Jason C. Huang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> <br> and <a href="https://github.com/Bulandent/hexo-theme-bubuzou" target="_blank">hexo-theme-bubuzou</a>.</p></div><div class="totop"><i></i></div></div></footer><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script src="/blog/scripts/jquery-1.8.2.min.js"></script><script src="/blog/scripts/arAnchor.js"></script><script src="/blog/scripts/main.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-6593436-5",'auto');ga('send','pageview');</script></body></html>